{% extends "base.html" %}

{% block title %}Edit PDF - RemakePdf{% endblock %}

{% block content %}
<section class="tool-page editor-page">
    <div class="container-fluid">
        <a href="/" class="back-link editor-back">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to All Tools
        </a>
        
        <div class="editor-workspace" id="editorWorkspace" style="display: none;">
            <div class="editor-toolbar">
                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn active" id="textTool" title="Add Text">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4 7 4 4 20 4 20 7"/>
                            <line x1="9" y1="20" x2="15" y2="20"/>
                            <line x1="12" y1="4" x2="12" y2="20"/>
                        </svg>
                        <span>Text</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                    <button type="button" class="toolbar-btn" id="linksTool" title="Add Links">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                        </svg>
                        <span>Links</span>
                    </button>
                    <button type="button" class="toolbar-btn" id="formsTool" title="Form Fields">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="9" x2="15" y2="9"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                        <span>Forms</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" id="imagesTool" title="Add Images">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        <span>Images</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                    <button type="button" class="toolbar-btn" id="signTool" title="Sign PDF">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                            <path d="M2 2l7.586 7.586"/>
                        </svg>
                        <span>Sign</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" id="whiteoutTool" title="Whiteout">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" fill="white" stroke="currentColor"/>
                            <line x1="7" y1="12" x2="17" y2="12" stroke-dasharray="2 2"/>
                        </svg>
                        <span>Whiteout</span>
                    </button>
                    <button type="button" class="toolbar-btn" id="annotateTool" title="Annotate">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                        <span>Annotate</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                    <button type="button" class="toolbar-btn" id="shapesTool" title="Shapes">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <circle cx="17.5" cy="6.5" r="4.5"/>
                            <polygon points="12 14 7 22 17 22 12 14"/>
                        </svg>
                        <span>Shapes</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" id="undoTool" title="Undo" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 10h10a5 5 0 0 1 5 5v2"/>
                            <polyline points="3 10 7 6"/>
                            <polyline points="3 10 7 14"/>
                        </svg>
                        <span>Undo</span>
                    </button>
                </div>
            </div>
            
            <div class="editor-page-bar">
                <div class="page-bar-left">
                    <span class="page-number-display" id="pageNumberDisplay">1</span>
                </div>
                <div class="page-bar-center">
                    <button type="button" class="page-bar-btn" id="rotatePage" title="Rotate Page">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </button>
                    <div class="zoom-group">
                        <button type="button" class="page-bar-btn" id="zoomOut" title="Zoom Out">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                        </button>
                        <button type="button" class="page-bar-btn" id="zoomIn" title="Zoom In">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="11" y1="8" x2="11" y2="14"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                        </button>
                    </div>
                    <button type="button" class="page-bar-btn" id="undoPageBtn" title="Undo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 10h10a5 5 0 0 1 5 5v2"/>
                            <polyline points="3 10 7 6"/>
                            <polyline points="3 10 7 14"/>
                        </svg>
                    </button>
                    <button type="button" class="page-bar-btn" id="redoPageBtn" title="Redo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10H11a5 5 0 0 0-5 5v2"/>
                            <polyline points="21 10 17 6"/>
                            <polyline points="21 10 17 14"/>
                        </svg>
                    </button>
                </div>
                <div class="page-bar-right">
                    <button type="button" class="insert-page-btn" id="insertPageBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="16"/>
                            <line x1="8" y1="12" x2="16" y2="12"/>
                        </svg>
                        Insert page here
                    </button>
                </div>
            </div>
            
            <div class="editor-canvas-area">
                <div class="editor-canvas-wrapper" id="editorCanvasWrapper">
                    <canvas id="pdfCanvas"></canvas>
                    <div class="editor-overlay" id="editorOverlay"></div>
                </div>
            </div>
            
            <div class="editor-page-nav">
                <button type="button" class="page-nav-btn" id="prevPage" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <span class="page-nav-info" id="pageInfo">Page 1 of 1</span>
                <button type="button" class="page-nav-btn" id="nextPage" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                </button>
            </div>
            
            <button type="button" class="apply-changes-btn" id="applyChangesBtn">
                Apply changes
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"/>
                </svg>
            </button>
        </div>
        
        <div class="initial-upload-area" id="initialUpload">
            <div class="tool-title">
                <h1>Edit PDF</h1>
                <p>Add text, images, shapes, annotations, and more to your PDF</p>
            </div>
            
            <div class="upload-card-centered">
                <div class="upload-zone" id="dropzone">
                    <div class="upload-icon-wrapper">
                        <svg class="upload-box-icon" viewBox="0 0 64 64" fill="none">
                            <path d="M52 24v28a4 4 0 01-4 4H16a4 4 0 01-4-4V24" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
                            <path d="M44 20L32 8 20 20" stroke="#3b82f6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M32 8v32" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Drag & drop your PDF here</h3>
                    <p>or</p>
                    <button type="button" class="btn btn-upload" id="browseBtn">Browse Files</button>
                    <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="result-area" id="resultArea" style="display: none;">
            <div class="result-icon success">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
            </div>
            <h2>PDF Edited Successfully!</h2>
            <p>Your edited PDF is ready for download.</p>
            <div class="download-buttons" id="downloadButtons"></div>
            <button type="button" class="btn btn-secondary" id="processAnother">Edit Another PDF</button>
        </div>
        
        <div class="error-area" id="errorArea" style="display: none;">
            <div class="result-icon error">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
            </div>
            <h2>Something went wrong</h2>
            <p id="errorMessage">An error occurred while processing your PDF.</p>
            <button type="button" class="btn btn-secondary" id="tryAgain">Try Again</button>
        </div>
    </div>
</section>

<div class="text-input-modal" id="textInputModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Text</h3>
            <button type="button" class="modal-close" id="closeTextModal">&times;</button>
        </div>
        <div class="modal-body">
            <textarea id="textInputArea" rows="3" placeholder="Enter your text..."></textarea>
            <div class="text-options">
                <div class="option-row">
                    <label>Font Size:</label>
                    <input type="number" id="textFontSize" value="14" min="8" max="72">
                </div>
                <div class="option-row">
                    <label>Color:</label>
                    <div class="color-picker">
                        <button type="button" class="color-opt active" data-color="#000000" style="background:#000"></button>
                        <button type="button" class="color-opt" data-color="#e74c3c" style="background:#e74c3c"></button>
                        <button type="button" class="color-opt" data-color="#3498db" style="background:#3498db"></button>
                        <button type="button" class="color-opt" data-color="#27ae60" style="background:#27ae60"></button>
                        <button type="button" class="color-opt" data-color="#9b59b6" style="background:#9b59b6"></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelText">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmText">Add Text</button>
        </div>
    </div>
</div>

<div class="image-upload-modal" id="imageUploadModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Image</h3>
            <button type="button" class="modal-close" id="closeImageModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="image-upload-zone" id="imageDropzone">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                <p>Drop image here or click to browse</p>
                <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
            </div>
            <div class="image-preview" id="imagePreview" style="display: none;">
                <img id="previewImg" src="" alt="Preview">
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelImage">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmImage" disabled>Add Image</button>
        </div>
    </div>
</div>

<div class="signature-modal" id="signatureModal" style="display: none;">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>Add Signature</h3>
            <button type="button" class="modal-close" id="closeSignModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="signature-tabs">
                <button type="button" class="sig-tab active" data-tab="draw">Draw</button>
                <button type="button" class="sig-tab" data-tab="type">Type</button>
                <button type="button" class="sig-tab" data-tab="upload">Upload</button>
            </div>
            <div class="signature-content">
                <div class="sig-panel active" id="drawPanel">
                    <canvas id="signatureCanvas" width="400" height="150"></canvas>
                    <button type="button" class="btn btn-sm" id="clearSignature">Clear</button>
                </div>
                <div class="sig-panel" id="typePanel">
                    <input type="text" id="typedSignature" placeholder="Type your signature...">
                    <select id="signatureFont">
                        <option value="cursive">Cursive</option>
                        <option value="serif">Serif</option>
                        <option value="sans-serif">Sans-serif</option>
                    </select>
                </div>
                <div class="sig-panel" id="uploadPanel">
                    <div class="sig-upload-zone" id="sigUploadZone">
                        <p>Click to upload signature image</p>
                        <input type="file" id="signatureFileInput" accept="image/*" style="display: none;">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelSignature">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmSignature">Add Signature</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>
<script src="/static/js/editor.js"></script>
{% endblock %}
